!function(h){var i=function(t){var e=this;this.obj=h(".js-lightBox"),this.setting=t,this.isIE6=/MSIE 6.0/gi.test(window.navigator.userAgent),this.defaultSetting={speed:"fast",scale:.8},h.extend(this.defaultSetting,this.getCustomSetting()),this.groupArr=[],this.clear=!1,this.groupName=null,this.bodyNode=h(document.body),this.popupMask=h("<div class='lightBox-popupMask'></div>"),this.popup=h("<div class='lightBox-popup'></div>"),this.settingDefaultImg(),this.obj.on("click",function(t){t.preventDefault(),t.stopPropagation();var i=h(this).attr("data-group");i!=e.groupName&&(e.groupName=i),e.defaultDOM(),e.getImageGroup(),e.initLightBox(h(this))})};i.prototype={getCustomSetting:function(){var t=this.setting;return t&&""!=t?t:{}},settingDefaultImg:function(){var i=this.obj;i.each(function(t){i.eq(t).attr("data-id",t)})},goto:function(t){this.groupArr.length;if("prev"===t){var i=this.groupArr[--this.index].src;this.loadCompletePicShow(i)}else{i=this.groupArr[++this.index].src;this.loadCompletePicShow(i)}},showMaskAndPopu:function(t,i){var e=this;_scale_=1,this.winWidth=h(window).width(),this.winHeight=h(window).height(),this.lightBoxPic.hide(),this.lightBoxDescription.hide(),this.lightBoxPopupMask.fadeIn(),this.lightPopup.fadeIn(),this.lightPopup.css({width:this.winWidth/2,height:this.winHeight/2,marginLeft:-this.winWidth/2/2,marginTop:-this.lightPopup.height()-8}).animate({marginTop:(this.winHeight-this.lightPopup.height()+8)/2},this.defaultSetting.speed,function(){e.loadCompletePicShow(e.src)})},settingParmt:function(t){this.src=t.attr("src"),this.title=t.attr("data-title"),this.lightBoxPic.attr("src",this.src)},getCurrentIndex:function(t){var e=t.attr("data-id"),o=0;return jQuery.each(this.groupArr,function(t,i){if(e==i.id)return o=t,!1}),o},loadPicShow:function(t,i){var e=new Image;window.ActiveXObject?e.onreadystatechange=function(){"complete"==this.readyState&&i()}:e.onload=function(){i()},e.src=t},loadCompletePicShow:function(o){var s=this;this.lightBoxPic.css({width:"auto",height:"auto"}).hide(),this.lightBoxDescription.hide(),this.winWidth=h(window).width(),this.winHeight=h(window).height(),this.clear=!0,s.loadPicShow(o,function(){s.lightBoxPic.attr("src",o);var t=s.lightBoxPic.width(),i=s.lightBoxPic.height(),e=s.groupArr.length;1<e&&(0===s.index?(s.lightBoxPrevBtn.addClass("disable"),s.lightBoxPrevBtn.removeClass("active"),s.lightBoxNextBtn.removeClass("disable")):(s.index===e-1?(s.lightBoxNextBtn.addClass("disable"),s.lightBoxNextBtn.removeClass("active")):s.lightBoxNextBtn.removeClass("disable"),s.lightBoxPrevBtn.removeClass("disable"))),t>s.winWidth||i>s.winHeight?_scale_=Math.min(s.winWidth/(t+12)*s.defaultSetting.scale,s.winHeight/(i+12)*s.defaultSetting.scale):_scale_=s.defaultSetting.scale,t*=_scale_,i*=_scale_,s.lightPopup.animate({width:t-12,height:i-12,marginLeft:-t/2,marginTop:(s.winHeight-i)/2},function(){s.lightBoxPic.css({width:t-12,height:i-12}),s.lightBoxTitle.text(s.groupArr[s.index].title),s.lightBoxCurrentIndex.text(s.index+1+" of "+s.groupArr.length),s.lightBoxPic.fadeIn(),s.lightBoxDescription.fadeIn()})})},initLightBox:function(t){var i=t.attr("src"),e=t.attr("data-id");this.settingParmt(t),this.showMaskAndPopu(i,e),this.index=this.getCurrentIndex(t)},defaultDOM:function(){var i=this;this.lightBoxView='<div class="loading"></div><div class="lightBox-view"><span class="lightBox-btn lightBox-prev-btn"></span><div class="lightBox-pic"><img src="" ></div><span class="lightBox-btn lightBox-next-btn"></span><div class="lightBox-description"><span class="lightBox-close"></span><b class="lightBox-title"></b><small class="lightBox-current-index"></small></div></div>',this.bodyNode.prepend(this.popupMask,this.popup),this.popup.html("").append(this.lightBoxView),this.lightBoxPopupMask=this.bodyNode.find(".lightBox-popupMask"),this.lightPopup=this.bodyNode.find(".lightBox-popup"),this.lightBoxPic=this.lightPopup.find(".lightBox-pic > img"),this.lightBoxPrevBtn=this.lightPopup.find(".lightBox-prev-btn"),this.lightBoxNextBtn=this.lightPopup.find(".lightBox-next-btn"),this.lightBoxClose=this.lightPopup.find(".lightBox-close"),this.lightBoxTitle=this.lightPopup.find(".lightBox-title"),this.lightBoxCurrentIndex=this.lightPopup.find(".lightBox-current-index"),this.lightBoxDescription=this.lightPopup.find(".lightBox-description"),this.lightBoxPopupMask.on("click",function(t){t.preventDefault(),t.stopPropagation(),h(this).fadeOut(),i.lightPopup.fadeOut(),i.clear=!1}),this.lightBoxClose.on("click",function(t){t.preventDefault(),t.stopPropagation(),i.lightPopup.fadeOut(),i.lightBoxPopupMask.fadeOut(),i.clear=!1}),this.lightBoxPrevBtn.hover(function(){!h(this).hasClass("disable")&&1<i.groupArr.length&&h(this).addClass("active")},function(){h(this).removeClass("active")}).on("click",function(t){h(this).hasClass("disable")||(t.preventDefault(),t.stopPropagation(),i.goto("prev"))});var e=null;h(window).resize(function(t){i.clear&&(clearTimeout(e),e=setTimeout(function(){i.loadCompletePicShow(i.groupArr[i.index].src)},500))}),document.onkeyup=function(t){"ArrowLeft"===(t=t||window.event).key||37===t.keyCode?i.lightBoxPrevBtn.click():"ArrowRight"!==t.key&&39!==t.keyCode||i.lightBoxNextBtn.click()},this.lightBoxNextBtn.hover(function(){!h(this).hasClass("disable")&&1<i.groupArr.length&&h(this).addClass("active")},function(){h(this).removeClass("active")}).on("click",function(t){h(this).hasClass("disable")||(t.preventDefault(),t.stopPropagation(),i.goto("next"))})},getImageGroup:function(){var e=this;e.groupArr=[],this.bodyNode.find("[data-group='"+this.groupName+"']").each(function(t,i){e.groupArr.push({src:h(i).attr("src"),title:h(i).attr("data-title"),id:h(i).attr("data-id"),group:h(i).attr("data-group"),src:h(i).attr("src")})})}},h.extend({DNLightBox:function(t){new i(t)}}),window.DNLightBox=i}(jQuery);